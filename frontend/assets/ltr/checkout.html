<!DOCTYPE html>
<html lang="en">

<head>
    <!--=====================================
                    META TAG PART START
        =======================================-->
    <!-- REQUIRE META -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- TEMPLATE META -->
    <meta name="name" content="Greeny" />
    <meta name="title" content="Greeny - eCommerce HTML Template" />
    <meta name="keywords"
        content="organic, food, shop, ecommerce, store, html, bootstrap, template, agriculture, vegetables, webshop, farm, grocery, natural, online store" />
    <!--=====================================
                    META-TAG PART END
        =======================================-->

    <!-- WEBPAGE TITLE -->
    <title>BharatFarm - Checkout</title>

    <!--=====================================
                    CSS LINK PART START
        =======================================-->
    <!-- FAVICON -->

    <!-- FONTS -->
    <link rel="stylesheet" href="fonts/flaticon/flaticon.css" />
    <link rel="stylesheet" href="fonts/icofont/icofont.min.css" />
    <link rel="stylesheet" href="fonts/fontawesome/fontawesome.min.css" />

    <!-- VENDOR -->
    <link rel="stylesheet" href="vendor/venobox/venobox.min.css" />
    <link rel="stylesheet" href="vendor/slickslider/slick.min.css" />
    <link rel="stylesheet" href="vendor/niceselect/nice-select.min.css" />
    <link rel="stylesheet" href="vendor/bootstrap/bootstrap.min.css" />

    <!-- CUSTOM -->
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/checkout.css" />
    <!--=====================================
                    CSS LINK PART END
        =======================================-->
</head>

<body>
    <div class="backdrop"></div>
    <a class="backtop fas fa-arrow-up" href="#"></a>

    <!--=====================================
                    HEADER PART START
        =======================================-->
    <div id="header"></div>

    <script type="module">
        import { loadHeader } from "./header.js";
        document.getElementById("header").innerHTML = loadHeader();
    </script>
    <!--=====================================
                    HEADER PART END
        =======================================-->

    <!--=====================================
                    NAVBAR PART START
        =======================================-->
    <div id="nav"></div>
    <script type="module">
        import { loadNavbar } from "./navbar.js";

        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("nav").innerHTML = loadNavbar();
        });
    </script>
    <!--=====================================
                    NAVBAR PART END
        =======================================-->

    <!--=====================================
                  CART SIDEBAR PART START
        =======================================-->
    <div id="cart-sidebar"></div>
    <!-- ✅ Placeholder for Cart Sidebar -->

    <script type="module">
        import { loadCartSidebar } from "./cart.js";
        let userId = localStorage.getItem("userId");
        console.log(userId);
        // ✅ Ensure the element exists before setting innerHTML
        document.getElementById("cart-sidebar").innerHTML =
            loadCartSidebar(userId);
    </script>
    <!--=====================================
                    CART SIDEBAR PART END
        =======================================-->

    <!--=====================================
                    PRODUCT VIEW START
        =======================================-->
    <div class="modal fade" id="product-view">
        <div class="modal-dialog">
            <div class="modal-content">
                <button class="modal-close icofont-close" data-bs-dismiss="modal"></button>
                <div class="product-view">
                    <div class="row">
                        <div class="col-md-6 col-lg-6">
                            <div class="view-gallery">
                                <div class="view-label-group">
                                    <label class="view-label new">new</label>
                                    <label class="view-label off">-10%</label>
                                </div>
                                <ul class="preview-slider slider-arrow">
                                    <li><img src="images/product/01.jpg" alt="product" /></li>
                                    <li><img src="images/product/01.jpg" alt="product" /></li>
                                    <li><img src="images/product/01.jpg" alt="product" /></li>
                                    <li><img src="images/product/01.jpg" alt="product" /></li>
                                </ul>
                                <ul class="thumb-slider">
                                    <li><img src="images/product/01.jpg" alt="product" /></li>
                                    <li><img src="images/product/01.jpg" alt="product" /></li>
                                    <li><img src="images/product/01.jpg" alt="product" /></li>
                                    <li><img src="images/product/01.jpg" alt="product" /></li>
                                    <li><img src="images/product/01.jpg" alt="product" /></li>
                                    <li><img src="images/product/01.jpg" alt="product" /></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-6">
                            <div class="view-details">
                                <h3 class="view-name">
                                    <a href="product-video.html">existing product name</a>
                                </h3>
                                <div class="view-meta">
                                    <p>SKU:<span>1234567</span></p>
                                    <p>BRAND:<a href="#">radhuni</a></p>
                                </div>
                                <div class="view-rating">
                                    <i class="active icofont-star"></i>
                                    <i class="active icofont-star"></i>
                                    <i class="active icofont-star"></i>
                                    <i class="active icofont-star"></i>
                                    <i class="icofont-star"></i>
                                    <a href="product-video.html">(3 reviews)</a>
                                </div>
                                <h3 class="view-price">
                                    <del>₹38.00</del>
                                    <span>₹24.00<small>/per kilo</small></span>
                                </h3>
                                <p class="view-desc">
                                    Lorem ipsum dolor sit amet consectetur adipisicing elit non
                                    tempora magni repudiandae sint suscipit tempore quis maxime
                                    explicabo veniam eos reprehenderit fuga
                                </p>
                                <div class="view-list-group">
                                    <label class="view-list-title">tags:</label>
                                    <ul class="view-tag-list">
                                        <li><a href="#">organic</a></li>
                                        <li><a href="#">vegetable</a></li>
                                        <li><a href="#">chilis</a></li>
                                    </ul>
                                </div>
                                <div class="view-list-group">
                                    <label class="view-list-title">Share:</label>
                                    <ul class="view-share-list">
                                        <li>
                                            <a href="#" class="icofont-facebook" title="Facebook"></a>
                                        </li>
                                        <li>
                                            <a href="#" class="icofont-twitter" title="Twitter"></a>
                                        </li>
                                        <li>
                                            <a href="#" class="icofont-linkedin" title="Linkedin"></a>
                                        </li>
                                        <li>
                                            <a href="#" class="icofont-instagram" title="Instagram"></a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="view-add-group">
                                    <button class="product-add" title="Add to Cart">
                                        <i class="fas fa-shopping-basket"></i>
                                        <span>add to cart</span>
                                    </button>
                                    <div class="product-action">
                                        <button class="action-minus" title="Quantity Minus">
                                            <i class="icofont-minus"></i>
                                        </button>
                                        <input class="action-input" title="Quantity Number" type="text" name="quantity"
                                            value="1" />
                                        <button class="action-plus" title="Quantity Plus">
                                            <i class="icofont-plus"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="view-action-group">
                                    <a class="view-wish wish" href="#" title="Add Your Wishlist">
                                        <i class="icofont-heart"></i>
                                        <span>add to wish</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--=====================================
                        PRODUCT VIEW END
            =======================================-->

    <!--=====================================
                    BANNER PART START
        =======================================-->
    <section class="inner-section single-banner" style="background: url(images/single-banner.jpg) no-repeat center">
        <div class="container">
            <h2>checkout</h2>
        </div>
    </section>
    <!--=====================================
                    BANNER PART END
        =======================================-->

    <!--=====================================
                    CHECKOUT PART START
        =======================================-->
    <section class="inner-section checkout-part">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="account-card">
                        <div class="account-title">
                            <h4>Your order</h4>
                        </div>
                        <div class="account-content">
                            <div class="table-scroll">
                                <table class="table-list">
                                    <thead>
                                        <tr>
                                            <th scope="col">Serial</th>
                                            <th scope="col">Product</th>
                                            <th scope="col">Name</th>
                                            <th scope="col">Price</th>
                                            <th scope="col">Quantity</th>
                                            <th scope="col">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cart-items">
                                        <!-- Cart items will be injected here by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Move JavaScript below -->
                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                const userId = localStorage.getItem("userId"); // Fetch userId from localStorage
                                loadCartItems(userId);
                            });

                            async function loadCartItems(userId) {
                                try {
                                    const response = await fetch(
                                        `http://localhost:5000/api/cart/user/${userId}`
                                    );
                                    if (!response.ok)
                                        throw new Error("Failed to fetch cart data");

                                    const cartItems = await response.json();
                                    renderCartItems(cartItems);
                                } catch (error) {
                                    console.error("❌ Error loading cart:", error);
                                }
                            }

                            function renderCartItems(cartItems) {
                                let cartTable = document.getElementById("cart-items");
                                cartTable.innerHTML = ""; // Clear existing rows

                                if (!cartItems.length) {
                                    cartTable.innerHTML = `<tr><td colspan="6"><h6 style="text-align:center;">No items in the cart</h6></td></tr>`;
                                    return;
                                }

                                cartItems.forEach((item, index) => {
                                    let row = document.createElement("tr");
                                    row.innerHTML = `
                                        <td class="table-serial"><h6>${index + 1
                                        }</h6></td>
                                        <td class="table-image"><img src="${item.image
                                        }" alt="product" style="width:50px; height:50px;"></td>
                                        <td class="table-name"><h6>${item.name
                                        }</h6></td>
                                        <td class="table-price"><h6>₹${item.price
                                        }<small>/kilo</small></h6></td>
                                        <td class="table-quantity"><h6>${item.quantity
                                        }</h6></td>
                                        <td class="table-action">
                                            
                                            <a class="trash" href="#" title="Remove from Cart" data-id="${item.productId
                                        }">
                                                <i class="icofont-trash"></i>
                                            </a>
                                        </td>
                                    `;
                                    cartTable.appendChild(row);
                                });

                                // Attach event listeners for delete buttons
                                document.querySelectorAll(".trash").forEach((button) => {
                                    button.addEventListener("click", async function () {
                                        let productId = this.getAttribute("data-id");
                                        await removeFromCart(productId);
                                    });
                                });
                            }

                            async function removeFromCart(productId) {
                                try {
                                    const userId = localStorage.getItem("userId"); // Fetch userId from localStorage
                                    const response = await fetch(
                                        `http://localhost:5000/api/cart/remove/${userId}/${productId}`,
                                        {
                                            method: "DELETE",
                                        }
                                    );

                                    if (!response.ok) throw new Error("Failed to remove item");

                                    console.log("✅ Item removed successfully");

                                    // Reload the page to reflect the changes
                                    location.reload();
                                } catch (error) {
                                    console.error("❌ Error removing item:", error);
                                }
                            }
                        </script>
                    </div>
                </div>

                <div class="col-lg-12">
                    <div class="account-card">
                        <div class="account-title">
                            <h4>Delivery Schedule</h4>
                        </div>
                        <div class="account-content">
                            <div class="row">
                                <div class="col-md-6 col-lg-4 alert fade show">
                                    <div class="profile-card schedule active">
                                        <h6>express</h6>
                                        <p>90 min express delivery</p>
                                    </div>
                                </div>
                                <div class="col-md-6 col-lg-4 alert fade show">
                                    <div class="profile-card schedule">
                                        <h6>8am-10pm</h6>
                                        <p>8.00 AM - 10.00 PM</p>
                                    </div>
                                </div>
                                <div class="col-md-6 col-lg-4 alert fade show">
                                    <div class="profile-card schedule">
                                        <h6>Next day</h6>
                                        <p>Next day or Tomorrow</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="account-card">
                        <div class="account-title">
                            <h4>contact number</h4>
                        </div>
                        <div class="account-content">
                            <div class="row">
                                <div class="col-md-6 col-lg-4 alert fade show">
                                    <div class="profile-card contact active">
                                        <h6>Primary</h6>
                                        <p id="phone-number">Loading...</p>
                                        <!-- Will update dynamically -->
                                        <ul>
                                            <li>
                                                <button class="edit icofont-edit" title="Edit This"
                                                    data-bs-toggle="modal" data-bs-target="#contact-edit"></button>
                                            </li>
                                            <li>

                                            </li>
                                        </ul>
                                    </div>
                                    <div class="profile-card contact ">
                                        <h6>Secondary</h6>
                                        <p id="phone-number-second">Loading...</p>
                                        <!-- Will update dynamically -->
                                        <ul>
                                            <li>
                                                <button class="edit icofont-edit" title="Edit This"
                                                    data-bs-toggle="modal" data-bs-target="#contact-edit2"></button>
                                            </li>
                                            <li>

                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <script>
                            document.addEventListener(
                                "DOMContentLoaded",
                                async function () {
                                    const phoneNumberElement =
                                        document.getElementById("phone-number");
                                    const phoneNumberSecondElement = document.getElementById(
                                        "phone-number-second"
                                    );
                                    const editFirstElement =
                                        document.getElementById("update-first");
                                    const editSecondElement =
                                        document.getElementById("update-second");
                                    const userId = localStorage.getItem("userId"); // Get user ID from localStorage

                                    if (!userId) {
                                        console.error("User ID not found in localStorage");
                                        phoneNumberElement.innerText = "User Not Found";
                                        return;
                                    }

                                    try {
                                        const response = await fetch(
                                            `http://localhost:5000/api/users/${userId}`
                                        ); // Adjust API endpoint as needed

                                        if (!response.ok) {
                                            console.error(
                                                "Failed to fetch user data:",
                                                response.statusText
                                            );
                                            phoneNumberElement.innerText =
                                                "Error Loading Phone Number";
                                            phoneNumberSecondElement.innerText =
                                                "Error Loading Phone Number";
                                            return;
                                        }

                                        const user = await response.json();

                                        if (user && user.phoneNumber) {
                                            phoneNumberElement.innerText = user.phoneNumber; // Display phone number
                                            editFirstElement.value = user.phoneNumber; // Display phone number
                                        } else {
                                            phoneNumberElement.innerText = "Not Available";
                                        }

                                        if (user && user.phoneNumberSecond) {
                                            phoneNumberSecondElement.innerText =
                                                user.phoneNumberSecond; // Display phone number
                                            editSecondElement.value = user.phoneNumberSecond; // Display phone number
                                        } else {
                                            phoneNumberSecondElement.innerText = "Not Available";
                                        }
                                    } catch (error) {
                                        console.error("Error fetching user data:", error);
                                        phoneNumberElement.innerText = "Error Fetching Data";
                                        phoneNumberSecondElement.innerText =
                                            "Error Fetching Data";
                                    }
                                }

                            );
                        </script>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="account-card">
                        <div class="account-title">
                            <h4>delivery address</h4>
                        </div>
                        <div class="account-content">
                            <div class="row">
                                <div class="col-md-6 col-lg-4 alert fade show">
                                    <div class="profile-card address active">
                                        <h6>Address - 1</h6>
                                        <p id="first-address">Loading...</p>
                                        <ul class="user-action">
                                            <li>
                                                <button class="edit icofont-edit" title="Edit This"
                                                    data-bs-toggle="modal" data-bs-target="#address-edit"></button>
                                            </li>
                                            <li>

                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-md-6 col-lg-4 alert fade show">
                                    <div class="profile-card address">
                                        <h6>Address - 2</h6>
                                        <p id="second-address">Loading...</p>
                                        <ul class="user-action">
                                            <li>
                                                <button class="edit icofont-edit" title="Edit This"
                                                    data-bs-toggle="modal" data-bs-target="#address-edit2"></button>
                                            </li>
                                            <li>

                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="checkout-check">
                                <input type="checkbox" id="checkout-check" />
                                <label for="checkout-check" id="checkout-label">
                                    By making this purchase you agree to our
                                    <a href="#">Terms and Conditions</a>.
                                </label>
                            </div>

                            <div class="checkout-proced">
                                <a class="btn btn-inline" href="invoice.html" id="checkout-btn">Proceed to Checkout</a>
                            </div>
                            <script>
                                document.addEventListener("DOMContentLoaded", function () {
                                    const checkbox = document.getElementById("checkout-check");
                                    const checkoutBtn = document.getElementById("checkout-btn");
                                    const label = document.getElementById("checkout-label");

                                    // Initially disable the button
                                    checkoutBtn.style.pointerEvents = "none";
                                    checkoutBtn.style.opacity = "0.5";

                                    // Listen for checkbox change
                                    checkbox.addEventListener("change", function () {
                                        if (checkbox.checked) {
                                            checkoutBtn.style.pointerEvents = "auto"; // Enable button
                                            checkoutBtn.style.opacity = "1";
                                            label.style.color = "black"; // Reset label color
                                        } else {
                                            checkoutBtn.style.pointerEvents = "none"; // Disable button
                                            checkoutBtn.style.opacity = "0.5";
                                        }
                                    });

                                    // Prevent navigation if checkbox is not checked
                                    checkoutBtn.addEventListener("click", function (event) {
                                        if (!checkbox.checked) {
                                            event.preventDefault(); // Stop navigation
                                            label.style.color = "red"; // Highlight label
                                            alert("Please agree to the Terms and Conditions before proceeding.");
                                        }
                                    });
                                });
                            </script>
                        </div>
                    </div>
                </div>

                <!-- iski script end mai likhi hai  -->
            </div>

            <script>
                document.addEventListener("DOMContentLoaded", async function () {

                    const addressFirstElement =
                        document.getElementById("first-address");

                    const addressSecondElement =
                        document.getElementById("second-address");

                    const editFirstElement = document.getElementById("update-address");

                    const userId = localStorage.getItem("userId"); // Get user ID from localStorage

                    if (!userId) {
                        console.error("User ID not found in localStorage");
                        addressFirstElement.innerText = "User Not Found";
                        return;
                    }

                    try {
                        const response = await fetch(
                            `http://localhost:5000/api/users/${userId}`
                        ); // Adjust API endpoint as needed

                        if (!response.ok) {
                            console.error(
                                "Failed to fetch user data:",
                                response.statusText
                            );
                            addressFirstElement.innerText = "Error Loading Phone Number";
                            addressSecondElement.innerText = "Error Loading Phone Number";
                            return;
                        }

                        const user = await response.json();

                        if (user && user.address) {
                            addressFirstElement.innerText = user.address; // Display phone number
                            editFirstElement.value = user.address; // Display phone number
                        } else {
                            addressFirstElement.innerText = "Not Available";
                        }

                        if (user && user.addressSecond) {
                            addressSecondElement.innerText = user.addressSecond; // Display phone number
                            // editSecondElement.value = user.addressSecond; // Display phone number
                        } else {
                            addressSecondElement.innerText = "Not Available";
                        }
                    } catch (error) {
                        console.error("Error fetching user data:", error);
                        addressFirstElement.innerText = "Error Fetching Data";
                        addressSecondElement.innerText = "Error Fetching Data";
                    }
                });
            </script>
        </div>
    </section>
    <!--=====================================
                    CHECKOUT PART END
        =======================================-->


    <!--=====================================
                    MODAL EDIT FORM START
        =======================================-->
    <!-- contact edit form -->
    <div class="modal fade" id="contact-edit">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <button class="modal-close" data-bs-dismiss="modal">
                    <i class="icofont-close"></i>
                </button>
                <form class="modal-form">
                    <div class="form-title">
                        <h3>edit contact info</h3>
                    </div>

                    <div class="form-group">
                        <label class="form-label">number</label>
                        <input class="form-control" id="update-first" type="text" value="+8801838288389" />
                    </div>
                    <button class="form-btn" id="edit-primary">
                        save contact info
                    </button>
                </form>
            </div>
        </div>

        <script>
            document
                .getElementById("edit-primary")
                .addEventListener("click", async function (event) {
                    event.preventDefault(); // Prevents form from reloading the page

                    const userId = localStorage.getItem("userId");
                    if (!userId) {
                        alert("User ID not found. Please log in again.");
                        return;
                    }

                    const newNumber = document
                        .getElementById("update-first")
                        .value.trim();

                    if (!/^\d{10}$/.test(newNumber)) {
                        alert("Invalid phone number. Must be 10 digits.");
                        return;
                    }

                    try {
                        const response = await fetch(
                            "http://localhost:5000/api/users/update",
                            {
                                method: "PUT",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify({
                                    userId,
                                    phoneNumber: newNumber, // Corrected variable name
                                }),
                            }
                        );

                        const data = await response.json();
                        console.log("Response from API:", data);

                        if (response.ok) {
                            document.getElementById("phone-number").innerText =
                                data.user.phoneNumber || "Not Available";

                            // **Close the modal after successful update**
                            const modalElement = document.getElementById("contact-edit");
                            const modalInstance = bootstrap.Modal.getInstance(modalElement);
                            modalInstance.hide(); // Hides the modal
                        } else {
                            alert(data.message || "Failed to update contact.");
                        }
                    } catch (error) {
                        console.error("❌ Error updating contact:", error);
                        alert("Something went wrong. Please try again.");
                    }
                    location.reload();
                });
        </script>
    </div>

    <div class="modal fade" id="contact-edit2">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <button class="modal-close" data-bs-dismiss="modal">
                    <i class="icofont-close"></i>
                </button>
                <form class="modal-form">
                    <div class="form-title">
                        <h3>edit contact info</h3>
                    </div>
                    <div class="form-group">
                        <label class="form-label">number</label>
                        <input class="form-control" id="update-second" type="text" value="+8801838288389" />
                    </div>
                    <button class="form-btn" id="edit-secondary">
                        save contact info
                    </button>
                </form>
            </div>
        </div>

        <script>
            document
                .getElementById("edit-secondary")
                .addEventListener("click", async function (event) {
                    event.preventDefault(); // Prevents form from reloading the page

                    const userId = localStorage.getItem("userId");
                    if (!userId) {
                        alert("User ID not found. Please log in again.");
                        return;
                    }

                    const newNumber = document
                        .getElementById("update-second")
                        .value.trim();

                    if (!/^\d{10}$/.test(newNumber)) {
                        alert("Invalid phone number. Must be 10 digits.");
                        return;
                    }

                    try {
                        const response = await fetch(
                            "http://localhost:5000/api/users/update",
                            {
                                method: "PUT",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify({
                                    userId,
                                    phoneNumberSecond: newNumber, // Corrected variable name
                                }),
                            }
                        );

                        const data = await response.json();
                        console.log("Response from API:", data);

                        if (response.ok) {
                            document.getElementById("phone-number-second").innerText =
                                data.user.phoneNumber || "Not Available";

                            // **Close the modal after successful update**
                            const modalElement = document.getElementById("contact-edit2");
                            const modalInstance = bootstrap.Modal.getInstance(modalElement);
                            modalInstance.hide(); // Hides the modal
                        } else {
                            alert(data.message || "Failed to update contact.");
                        }
                    } catch (error) {
                        console.error("❌ Error updating contact:", error);
                        alert("Something went wrong. Please try again.");
                    }
                    location.reload();
                });
        </script>
    </div>

    <!-- address edit form -->
    <div class="modal fade" id="address-edit">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <button class="modal-close" data-bs-dismiss="modal">
                    <i class="icofont-close"></i>
                </button>
                <form class="modal-form">
                    <div class="form-title">
                        <h3>edit address info</h3>
                    </div>

                    <div class="form-group">
                        <label class="form-label">address</label>
                        <textarea class="form-control" id="update-address"
                            placeholder="jalkuri, fatullah, narayanganj-1420. word no-09, road no-17/A"></textarea>
                    </div>
                    <button class="form-btn" id="edit-address">
                        save address info
                    </button>
                </form>
            </div>
        </div>
        <script>
            document
                .getElementById("edit-address")
                .addEventListener("click", async function (event) {
                    event.preventDefault(); // Prevents form from reloading the page

                    const userId = localStorage.getItem("userId");
                    if (!userId) {
                        alert("User ID not found. Please log in again.");
                        return;
                    }

                    const newAddress = document
                        .getElementById("update-address")
                        .value.trim();

                    try {
                        const response = await fetch(
                            "http://localhost:5000/api/users/update",
                            {
                                method: "PUT",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify({
                                    userId,
                                    address: newAddress, // Corrected variable name
                                }),
                            }
                        );

                        const data = await response.json();
                        console.log("Response from API:", data);

                        if (response.ok) {
                            document.getElementById("first-address").innerText =
                                data.user.address || "Not Available";

                            // **Close the modal after successful update**
                            const modalElement = document.getElementById("address-edit");
                            const modalInstance = bootstrap.Modal.getInstance(modalElement);
                            modalInstance.hide(); // Hides the modal
                        } else {
                            alert(data.message || "Failed to update address.");
                        }
                    } catch (error) {
                        console.error("❌ Error updating address:", error);
                        alert("Something went wrong. Please try again.");
                    }
                    location.reload();
                });
        </script>
    </div>

    <div class="modal fade" id="address-edit2">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <button class="modal-close" data-bs-dismiss="modal">
                    <i class="icofont-close"></i>
                </button>
                <form class="modal-form">
                    <div class="form-title">
                        <h3>edit address info</h3>
                    </div>

                    <div class="form-group">
                        <label class="form-label">address</label>
                        <textarea class="form-control" id="update-address2"
                            placeholder="jalkuri, fatullah, narayanganj-1420. word no-09, road no-17/A"></textarea>
                    </div>
                    <button class="form-btn" id="edit-address2">
                        save address info
                    </button>
                </form>
            </div>
        </div>
        <script>
            document
                .getElementById("edit-address2")
                .addEventListener("click", async function (event) {
                    event.preventDefault(); // Prevents form from reloading the page

                    const userId = localStorage.getItem("userId");
                    if (!userId) {
                        alert("User ID not found. Please log in again.");
                        return;
                    }

                    const newAddress = document
                        .getElementById("update-address2")
                        .value.trim();

                    try {
                        const response = await fetch(
                            "http://localhost:5000/api/users/update",
                            {
                                method: "PUT",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify({
                                    userId,
                                    addressSecond: newAddress, // Corrected variable name
                                }),
                            }
                        );

                        const data = await response.json();
                        console.log("Response from API:", data);

                        if (response.ok) {
                            document.getElementById("second-address").innerText =
                                data.user.address || "Not Available";

                            // **Close the modal after successful update**
                            const modalElement = document.getElementById("address-edit2");
                            const modalInstance = bootstrap.Modal.getInstance(modalElement);
                            modalInstance.hide(); // Hides the modal
                        } else {
                            alert(data.message || "Failed to update address.");
                        }
                    } catch (error) {
                        console.error("❌ Error updating address:", error);
                        alert("Something went wrong. Please try again.");
                    }
                    location.reload();
                });
        </script>
    </div>
    <!--=====================================
                    MODAL EDIT FORM END
        =======================================-->

    <!--=====================================
                    INTRO PART START
        =======================================-->
    <section class="intro-part">
        <div class="container">
            <div class="row intro-content">
                <div class="col-sm-6 col-lg-3">
                    <div class="intro-wrap">
                        <div class="intro-icon">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="intro-content">
                            <h5>free home delivery</h5>
                            <p>Lorem ipsum dolor sit amet adipisicing elit nobis.</p>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-3">
                    <div class="intro-wrap">
                        <div class="intro-icon">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <div class="intro-content">
                            <h5>instant return policy</h5>
                            <p>Lorem ipsum dolor sit amet adipisicing elit nobis.</p>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-3">
                    <div class="intro-wrap">
                        <div class="intro-icon">
                            <i class="fas fa-headset"></i>
                        </div>
                        <div class="intro-content">
                            <h5>quick support system</h5>
                            <p>Lorem ipsum dolor sit amet adipisicing elit nobis.</p>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-3">
                    <div class="intro-wrap">
                        <div class="intro-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                        <div class="intro-content">
                            <h5>secure payment way</h5>
                            <p>Lorem ipsum dolor sit amet adipisicing elit nobis.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--=====================================
                    INTRO PART END
        =======================================-->

    <!--=====================================
                     FOOTER PART START
        =======================================-->
    <div id="footer"></div>

    <script type="module">
        import { loadFooter } from "./footer.js";
        document.getElementById("footer").innerHTML = loadFooter();
    </script>
    <!--=====================================
                      FOOTER PART END
        =======================================-->

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            function updateCheckoutData() {
                const userData = {
                    phoneNumber: document.querySelector(".profile-card.contact.active p")?.innerText || "Not Available",
                    address: document.querySelector(".profile-card.address.active p")?.innerText || "Not Available",
                    deliverySchedule: document.querySelector(".profile-card.schedule.active h6")?.innerText || "Not Available",
                };

                localStorage.setItem("checkoutData", JSON.stringify(userData));
            }

            // Function to handle click and update active class
            function handleSelection(event) {
                const parent = event.target.closest(".profile-card");
                if (!parent) return;

                const category = parent.classList.contains("contact") ? "contact" :
                    parent.classList.contains("address") ? "address" :
                        parent.classList.contains("schedule") ? "schedule" : null;

                if (!category) return;

                // Remove active class from all in that category
                document.querySelectorAll(`.profile-card.${category}`).forEach(el => el.classList.remove("active"));

                // Add active class to clicked card
                parent.classList.add("active");

                // Update localStorage with new selection
                updateCheckoutData();
            }

            // Attach event listeners to all profile-card elements
            document.querySelectorAll(".profile-card").forEach(card => {
                card.addEventListener("click", handleSelection);
            });

            // Load last selection from localStorage on page load
            const storedData = localStorage.getItem("checkoutData");
            if (storedData) {
                const userData = JSON.parse(storedData);

                document.querySelectorAll(".profile-card.contact p").forEach(el => {
                    if (el.innerText === userData.phoneNumber) el.closest(".profile-card").classList.add("active");
                });

                document.querySelectorAll(".profile-card.address p").forEach(el => {
                    if (el.innerText === userData.address) el.closest(".profile-card").classList.add("active");
                });

                document.querySelectorAll(".profile-card.schedule h6").forEach(el => {
                    if (el.innerText === userData.deliverySchedule) el.closest(".profile-card").classList.add("active");
                });
            }
        });

    </script>

    <!--=====================================
                    JS LINK PART START
        =======================================-->
    <!-- VENDOR -->
    <script src="vendor/bootstrap/jquery-1.12.4.min.js"></script>
    <script src="vendor/bootstrap/popper.min.js"></script>
    <script src="vendor/bootstrap/bootstrap.min.js"></script>
    <script src="vendor/countdown/countdown.min.js"></script>
    <script src="vendor/niceselect/nice-select.min.js"></script>
    <script src="vendor/slickslider/slick.min.js"></script>
    <script src="vendor/venobox/venobox.min.js"></script>

    <!-- CUSTOM -->
    <script src="js/nice-select.js"></script>
    <script src="js/countdown.js"></script>
    <script src="js/accordion.js"></script>
    <script src="js/venobox.js"></script>
    <script src="js/slick.js"></script>
    <script src="js/main.js"></script>
    <!--=====================================
                    JS LINK PART END
        =======================================-->
</body>

</html>